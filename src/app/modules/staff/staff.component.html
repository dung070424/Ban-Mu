<div class="staff-container">
  <!-- Header -->
  <div class="staff-header">
    <div class="header-left">
      <h1>Qu·∫£n l√Ω nh√¢n vi√™n</h1>
      <p>Qu·∫£n l√Ω th√¥ng tin nh√¢n vi√™n v√† ph√≤ng ban</p>
    </div>
    <div class="header-right">
      <button class="add-staff-btn" (click)="openAddModal()">
        <span>+</span>
        Th√™m nh√¢n vi√™n
      </button>
    </div>
  </div>

  <!-- Statistics -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">üë•</div>
      <div class="stat-content">
        <div class="stat-value">{{ totalStaff() }}</div>
        <div class="stat-label">T·ªïng nh√¢n vi√™n</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-content">
        <div class="stat-value">{{ activeStaff() }}</div>
        <div class="stat-label">ƒêang l√†m vi·ªác</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üí∞</div>
      <div class="stat-content">
        <div class="stat-value">{{ formatVnd(totalSalary()) }}</div>
        <div class="stat-label">T·ªïng l∆∞∆°ng</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üìä</div>
      <div class="stat-content">
        <div class="stat-value">{{ formatVnd(averageSalary()) }}</div>
        <div class="stat-label">L∆∞∆°ng trung b√¨nh</div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="search-box">
      <input
        type="text"
        placeholder="T√¨m ki·∫øm nh√¢n vi√™n..."
        [value]="searchTerm()"
        (input)="onSearchInput($event)"
      />
      <span class="search-icon">üîç</span>
    </div>
    <select
      [value]="selectedDepartment()"
      (change)="onDepartmentChange($event)"
      class="filter-select"
    >
      @for (department of departments(); track department.id) {
      <option [value]="department.id">{{ department.name }}</option>
      }
    </select>
    <select [value]="selectedStatus()" (change)="onStatusChange($event)" class="filter-select">
      <option value="all">T·∫•t c·∫£ tr·∫°ng th√°i</option>
      <option value="active">ƒêang l√†m vi·ªác</option>
      <option value="inactive">Ngh·ªâ vi·ªác</option>
    </select>
  </div>

  <!-- Staff Grid -->
  <div class="staff-grid">
    @for (member of filteredStaff(); track member.id) {
    <div class="staff-card">
      <div class="staff-avatar">
        @if (member.avatar) {
        <img [src]="member.avatar" [alt]="member.name" />
        } @else {
        <div class="avatar-placeholder">
          {{ getInitials(member.name) }}
        </div>
        }
        <div class="status-indicator" [class]="'status-' + member.status"></div>
      </div>

      <div class="staff-info">
        <h3 class="staff-name">{{ member.name }}</h3>
        <p class="staff-position">{{ member.position }}</p>
        <p class="staff-department">{{ member.department }}</p>
        <div class="staff-details">
          <div class="detail-item">
            <span class="detail-label">üìß</span>
            <span class="detail-value">{{ member.email }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">üìû</span>
            <span class="detail-value">{{ member.phone }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">üí∞</span>
            <span class="detail-value">{{ formatVnd(member.salary) }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">üìÖ</span>
            <span class="detail-value">{{ getWorkDuration(member.hireDate) }}</span>
          </div>
        </div>
      </div>

      <div class="staff-actions">
        <button class="action-btn view-btn" (click)="openDetailModal(member)">üëÅÔ∏è</button>
        <button class="action-btn edit-btn" (click)="openEditModal(member)">‚úèÔ∏è</button>
        <button
          class="action-btn status-btn"
          [class]="'status-' + member.status"
          (click)="toggleStaffStatus(member)"
        >
          {{ member.status === 'active' ? '‚úÖ' : '‚ùå' }}
        </button>
        <button class="action-btn delete-btn" (click)="deleteStaff(member.id)">üóëÔ∏è</button>
      </div>
    </div>
    }
  </div>

  <!-- Add Staff Modal -->
  @if (showAddModal()) {
  <div class="modal-overlay" (click)="closeModals()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Th√™m nh√¢n vi√™n m·ªõi</h3>
        <button class="close-btn" (click)="closeModals()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <div class="form-group">
            <label>H·ªç v√† t√™n *</label>
            <input type="text" [(ngModel)]="newStaff().name" placeholder="Nh·∫≠p h·ªç v√† t√™n" />
          </div>
          <div class="form-group">
            <label>Email *</label>
            <input type="email" [(ngModel)]="newStaff().email" placeholder="email@example.com" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>S·ªë ƒëi·ªán tho·∫°i *</label>
            <input type="tel" [(ngModel)]="newStaff().phone" placeholder="0901234567" />
          </div>
          <div class="form-group">
            <label>Ch·ª©c v·ª•</label>
            <input type="text" [(ngModel)]="newStaff().position" placeholder="Nh√¢n vi√™n b√°n h√†ng" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Ph√≤ng ban</label>
            <input type="text" [(ngModel)]="newStaff().department" placeholder="B√°n h√†ng" />
          </div>
          <div class="form-group">
            <label>L∆∞∆°ng (VNƒê)</label>
            <input type="number" [(ngModel)]="newStaff().salary" placeholder="8000000" />
          </div>
        </div>
        <div class="form-group">
          <label>ƒê·ªãa ch·ªâ</label>
          <input
            type="text"
            [(ngModel)]="newStaff().address"
            placeholder="123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM"
          />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Li√™n h·ªá kh·∫©n c·∫•p</label>
            <input
              type="text"
              [(ngModel)]="newStaff().emergencyContact"
              placeholder="T√™n ng∆∞·ªùi li√™n h·ªá"
            />
          </div>
          <div class="form-group">
            <label>S·ªë ƒëi·ªán tho·∫°i kh·∫©n c·∫•p</label>
            <input type="tel" [(ngModel)]="newStaff().emergencyPhone" placeholder="0907654321" />
          </div>
        </div>
        <div class="form-group">
          <label>Ghi ch√∫</label>
          <textarea
            [(ngModel)]="newStaff().notes"
            placeholder="Ghi ch√∫ v·ªÅ nh√¢n vi√™n"
            rows="3"
          ></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn" (click)="closeModals()">H·ªßy</button>
        <button class="save-btn" (click)="addStaff()">Th√™m nh√¢n vi√™n</button>
      </div>
    </div>
  </div>
  }

  <!-- Edit Staff Modal -->
  @if (showEditModal() && selectedStaff()) {
  <div class="modal-overlay" (click)="closeModals()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Ch·ªânh s·ª≠a nh√¢n vi√™n</h3>
        <button class="close-btn" (click)="closeModals()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <div class="form-group">
            <label>H·ªç v√† t√™n *</label>
            <input
              type="text"
              [value]="selectedStaff()?.name"
              (input)="onStaffFieldChange('name', $event)"
            />
          </div>
          <div class="form-group">
            <label>Email *</label>
            <input
              type="email"
              [value]="selectedStaff()?.email"
              (input)="onStaffFieldChange('email', $event)"
            />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>S·ªë ƒëi·ªán tho·∫°i *</label>
            <input
              type="tel"
              [value]="selectedStaff()?.phone"
              (input)="onStaffFieldChange('phone', $event)"
            />
          </div>
          <div class="form-group">
            <label>Ch·ª©c v·ª•</label>
            <input
              type="text"
              [value]="selectedStaff()?.position"
              (input)="onStaffFieldChange('position', $event)"
            />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Ph√≤ng ban</label>
            <input
              type="text"
              [value]="selectedStaff()?.department"
              (input)="onStaffFieldChange('department', $event)"
            />
          </div>
          <div class="form-group">
            <label>L∆∞∆°ng (VNƒê)</label>
            <input
              type="number"
              [value]="selectedStaff()?.salary"
              (input)="onStaffNumberFieldChange('salary', $event)"
            />
          </div>
        </div>
        <div class="form-group">
          <label>ƒê·ªãa ch·ªâ</label>
          <input
            type="text"
            [value]="selectedStaff()?.address"
            (input)="onStaffFieldChange('address', $event)"
          />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Li√™n h·ªá kh·∫©n c·∫•p</label>
            <input
              type="text"
              [value]="selectedStaff()?.emergencyContact"
              (input)="onStaffFieldChange('emergencyContact', $event)"
            />
          </div>
          <div class="form-group">
            <label>S·ªë ƒëi·ªán tho·∫°i kh·∫©n c·∫•p</label>
            <input
              type="tel"
              [value]="selectedStaff()?.emergencyPhone"
              (input)="onStaffFieldChange('emergencyPhone', $event)"
            />
          </div>
        </div>
        <div class="form-group">
          <label>Ghi ch√∫</label>
          <textarea
            [value]="selectedStaff()?.notes"
            (input)="onStaffFieldChange('notes', $event)"
            rows="3"
          ></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn" (click)="closeModals()">H·ªßy</button>
        <button class="save-btn" (click)="updateStaff()">C·∫≠p nh·∫≠t</button>
      </div>
    </div>
  </div>
  }

  <!-- Staff Detail Modal -->
  @if (showDetailModal() && selectedStaff()) {
  <div class="modal-overlay" (click)="closeModals()">
    <div class="modal-content detail-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Th√¥ng tin chi ti·∫øt nh√¢n vi√™n</h3>
        <button class="close-btn" (click)="closeModals()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="staff-detail-header">
          <div class="detail-avatar">
            @if (selectedStaff()?.avatar) {
            <img [src]="selectedStaff()?.avatar" [alt]="selectedStaff()?.name" />
            } @else {
            <div class="avatar-placeholder large">
              {{ getInitials(selectedStaff()?.name || '') }}
            </div>
            }
          </div>
          <div class="detail-info">
            <h2>{{ selectedStaff()?.name }}</h2>
            <p class="detail-position">{{ selectedStaff()?.position }}</p>
            <p class="detail-department">{{ selectedStaff()?.department }}</p>
            <div class="detail-status" [class]="'status-' + selectedStaff()?.status">
              {{ selectedStaff()?.status === 'active' ? 'ƒêang l√†m vi·ªác' : 'Ngh·ªâ vi·ªác' }}
            </div>
          </div>
        </div>

        <div class="detail-sections">
          <div class="detail-section">
            <h4>Th√¥ng tin li√™n h·ªá</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">Email:</span>
                <span class="detail-value">{{ selectedStaff()?.email }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">S·ªë ƒëi·ªán tho·∫°i:</span>
                <span class="detail-value">{{ selectedStaff()?.phone }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">ƒê·ªãa ch·ªâ:</span>
                <span class="detail-value">{{ selectedStaff()?.address }}</span>
              </div>
            </div>
          </div>

          <div class="detail-section">
            <h4>Th√¥ng tin c√¥ng vi·ªác</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">L∆∞∆°ng:</span>
                <span class="detail-value">{{ formatVnd(selectedStaff()?.salary || 0) }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Ng√†y v√†o l√†m:</span>
                <span class="detail-value">{{
                  formatDateOrCurrent(selectedStaff()?.hireDate)
                }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Th·ªùi gian l√†m vi·ªác:</span>
                <span class="detail-value">{{
                  getWorkDurationOrCurrent(selectedStaff()?.hireDate)
                }}</span>
              </div>
            </div>
          </div>

          <div class="detail-section">
            <h4>Li√™n h·ªá kh·∫©n c·∫•p</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">T√™n ng∆∞·ªùi li√™n h·ªá:</span>
                <span class="detail-value">{{ selectedStaff()?.emergencyContact }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">S·ªë ƒëi·ªán tho·∫°i:</span>
                <span class="detail-value">{{ selectedStaff()?.emergencyPhone }}</span>
              </div>
            </div>
          </div>

          @if (selectedStaff()?.notes) {
          <div class="detail-section">
            <h4>Ghi ch√∫</h4>
            <p class="detail-notes">{{ selectedStaff()?.notes }}</p>
          </div>
          }
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn" (click)="closeModals()">ƒê√≥ng</button>
        <button class="edit-btn" (click)="openEditModal(selectedStaff()!)">Ch·ªânh s·ª≠a</button>
      </div>
    </div>
  </div>
  }
</div>
