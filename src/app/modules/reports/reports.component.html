<div class="reports-container">
  <!-- Header -->
  <div class="reports-header">
    <div class="header-left">
      <h1>B√°o c√°o & Th·ªëng k√™</h1>
      <p>Ph√¢n t√≠ch hi·ªáu su·∫•t kinh doanh v√† xu h∆∞·ªõng b√°n h√†ng</p>
    </div>
    <div class="header-right">
      <div class="report-controls">
        <select [value]="selectedPeriod()" (change)="onPeriodChange($event)" class="period-select">
          <option value="7days">7 ng√†y qua</option>
          <option value="30days">30 ng√†y qua</option>
          <option value="90days">90 ng√†y qua</option>
        </select>
        <button class="export-btn" (click)="exportReport()">üìä Xu·∫•t b√°o c√°o</button>
      </div>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="summary-grid">
    <div class="summary-card">
      <div class="card-icon">üí∞</div>
      <div class="card-content">
        <div class="card-value">{{ formatVnd(totalRevenue()) }}</div>
        <div class="card-label">T·ªïng doanh thu</div>
        <div class="card-growth" [style.color]="getGrowthColor(dailyGrowth())">
          {{ getGrowthIcon(dailyGrowth()) }} {{ formatPercentage(dailyGrowth()) }}
        </div>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-icon">üõí</div>
      <div class="card-content">
        <div class="card-value">{{ formatNumber(totalOrders()) }}</div>
        <div class="card-label">T·ªïng ƒë∆°n h√†ng</div>
        <div class="card-subtitle">
          Trung b√¨nh {{ formatNumber(roundNumber(averageOrderValue())) }}/ƒë∆°n
        </div>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-icon">üì¶</div>
      <div class="card-content">
        <div class="card-value">{{ formatNumber(totalProducts()) }}</div>
        <div class="card-label">S·∫£n ph·∫©m b√°n ra</div>
        <div class="card-subtitle">
          {{ formatNumber(roundNumber(totalProducts() / totalOrders())) }} s·∫£n ph·∫©m/ƒë∆°n
        </div>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-icon">üìà</div>
      <div class="card-content">
        <div class="card-value">{{ formatVnd(averageOrderValue()) }}</div>
        <div class="card-label">Gi√° tr·ªã ƒë∆°n h√†ng TB</div>
        <div class="card-subtitle">Trung b√¨nh m·ªói ƒë∆°n h√†ng</div>
      </div>
    </div>
  </div>

  <!-- Report Tabs -->
  <div class="report-tabs">
    <button
      class="tab-btn"
      [class.active]="selectedReportType() === 'sales'"
      (click)="onReportTypeClick('sales')"
    >
      üìä Doanh s·ªë
    </button>
    <button
      class="tab-btn"
      [class.active]="selectedReportType() === 'products'"
      (click)="onReportTypeClick('products')"
    >
      üèÜ S·∫£n ph·∫©m b√°n ch·∫°y
    </button>
    <button
      class="tab-btn"
      [class.active]="selectedReportType() === 'staff'"
      (click)="onReportTypeClick('staff')"
    >
      üë• Hi·ªáu su·∫•t nh√¢n vi√™n
    </button>
    <button
      class="tab-btn"
      [class.active]="selectedReportType() === 'categories'"
      (click)="onReportTypeClick('categories')"
    >
      üìÇ Danh m·ª•c
    </button>
  </div>

  <!-- Report Content -->
  <div class="report-content">
    <!-- Sales Report -->
    @if (selectedReportType() === 'sales') {
    <div class="report-section">
      <h3>Bi·ªÉu ƒë·ªì doanh thu theo ng√†y</h3>
      <div class="chart-container">
        <div class="chart-placeholder">
          <div class="chart-mock">
            @for (day of filteredSalesData(); track day.date) {
            <div class="chart-bar" [style.height.%]="getRevenuePercentage(day.revenue)">
              <div class="bar-value">{{ formatVnd(day.revenue) }}</div>
            </div>
            }
          </div>
          <div class="chart-labels">
            @for (day of filteredSalesData(); track day.date) {
            <div class="chart-label">{{ formatDate(day.date) }}</div>
            }
          </div>
        </div>
      </div>

      <div class="sales-table">
        <h4>Chi ti·∫øt doanh thu theo ng√†y</h4>
        <table>
          <thead>
            <tr>
              <th>Ng√†y</th>
              <th>Doanh thu</th>
              <th>S·ªë ƒë∆°n h√†ng</th>
              <th>S·∫£n ph·∫©m b√°n ra</th>
              <th>Gi√° tr·ªã TB/ƒë∆°n</th>
            </tr>
          </thead>
          <tbody>
            @for (day of filteredSalesData(); track day.date) {
            <tr>
              <td>{{ formatDate(day.date) }}</td>
              <td class="revenue-cell">{{ formatVnd(day.revenue) }}</td>
              <td>{{ formatNumber(day.orders) }}</td>
              <td>{{ formatNumber(day.products) }}</td>
              <td>{{ formatVnd(day.revenue / day.orders) }}</td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
    }

    <!-- Products Report -->
    @if (selectedReportType() === 'products') {
    <div class="report-section">
      <div class="products-grid">
        <div class="products-chart">
          <h3>S·∫£n ph·∫©m b√°n ch·∫°y nh·∫•t</h3>
          <div class="top-products">
            @for (product of topSellingProducts(); track product.productId) {
            <div class="product-item">
              <div class="product-rank">#{{ $index + 1 }}</div>
              <div class="product-info">
                <div class="product-name">{{ product.productName }}</div>
                <div class="product-category">{{ product.category }}</div>
              </div>
              <div class="product-stats">
                <div class="product-quantity">{{ formatNumber(product.quantitySold) }} c√°i</div>
                <div class="product-revenue">{{ formatVnd(product.revenue) }}</div>
              </div>
            </div>
            }
          </div>
        </div>

        <div class="revenue-chart">
          <h3>S·∫£n ph·∫©m c√≥ doanh thu cao nh·∫•t</h3>
          <div class="top-revenue">
            @for (product of topRevenueProducts(); track product.productId) {
            <div class="revenue-item">
              <div class="revenue-rank">#{{ $index + 1 }}</div>
              <div class="revenue-info">
                <div class="revenue-name">{{ product.productName }}</div>
                <div class="revenue-category">{{ product.category }}</div>
              </div>
              <div class="revenue-amount">{{ formatVnd(product.revenue) }}</div>
            </div>
            }
          </div>
        </div>
      </div>

      <div class="products-table">
        <h4>B√°o c√°o chi ti·∫øt s·∫£n ph·∫©m</h4>
        <table>
          <thead>
            <tr>
              <th>S·∫£n ph·∫©m</th>
              <th>Danh m·ª•c</th>
              <th>S·ªë l∆∞·ª£ng b√°n</th>
              <th>Doanh thu</th>
              <th>L·ª£i nhu·∫≠n</th>
              <th>T·ª∑ l·ªá l·ª£i nhu·∫≠n</th>
            </tr>
          </thead>
          <tbody>
            @for (product of productSales(); track product.productId) {
            <tr>
              <td class="product-name-cell">{{ product.productName }}</td>
              <td>{{ product.category }}</td>
              <td>{{ formatNumber(product.quantitySold) }}</td>
              <td class="revenue-cell">{{ formatVnd(product.revenue) }}</td>
              <td class="profit-cell">{{ formatVnd(product.profit) }}</td>
              <td>{{ formatPercentage((product.profit / product.revenue) * 100) }}</td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
    }

    <!-- Staff Report -->
    @if (selectedReportType() === 'staff') {
    <div class="report-section">
      <h3>Hi·ªáu su·∫•t nh√¢n vi√™n</h3>
      <div class="staff-performance">
        @for (staff of topPerformingStaff(); track staff.staffId) {
        <div class="staff-card">
          <div class="staff-rank">#{{ $index + 1 }}</div>
          <div class="staff-info">
            <div class="staff-name">{{ staff.staffName }}</div>
            <div class="staff-stats">
              <span>{{ formatNumber(staff.orders) }} ƒë∆°n h√†ng</span>
              <span>‚Ä¢</span>
              <span>{{ formatVnd(staff.commission) }} hoa h·ªìng</span>
            </div>
          </div>
          <div class="staff-sales">{{ formatVnd(staff.sales) }}</div>
        </div>
        }
      </div>

      <div class="staff-table">
        <h4>B√°o c√°o chi ti·∫øt nh√¢n vi√™n</h4>
        <table>
          <thead>
            <tr>
              <th>Nh√¢n vi√™n</th>
              <th>Doanh s·ªë</th>
              <th>S·ªë ƒë∆°n h√†ng</th>
              <th>Hoa h·ªìng</th>
              <th>Doanh s·ªë TB/ƒë∆°n</th>
            </tr>
          </thead>
          <tbody>
            @for (staff of staffPerformance(); track staff.staffId) {
            <tr>
              <td class="staff-name-cell">{{ staff.staffName }}</td>
              <td class="revenue-cell">{{ formatVnd(staff.sales) }}</td>
              <td>{{ formatNumber(staff.orders) }}</td>
              <td class="commission-cell">{{ formatVnd(staff.commission) }}</td>
              <td>{{ formatVnd(staff.orders > 0 ? staff.sales / staff.orders : 0) }}</td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
    }

    <!-- Categories Report -->
    @if (selectedReportType() === 'categories') {
    <div class="report-section">
      <h3>Doanh thu theo danh m·ª•c</h3>
      <div class="categories-chart">
        @for (category of categorySales(); track category.category) {
        <div class="category-item">
          <div class="category-info">
            <div class="category-name">{{ category.category }}</div>
            <div class="category-quantity">{{ formatNumber(category.quantity) }} s·∫£n ph·∫©m</div>
          </div>
          <div class="category-revenue">{{ formatVnd(category.revenue) }}</div>
          <div class="category-bar">
            <div
              class="bar-fill"
              [style.width.%]="getCategoryRevenuePercentage(category.revenue)"
            ></div>
          </div>
        </div>
        }
      </div>
    </div>
    }
  </div>
</div>
