<div class="customers-container">
  <!-- Header -->
  <div class="customers-header">
    <div class="header-left">
      <h1>Qu·∫£n l√Ω kh√°ch h√†ng</h1>
      <p>Qu·∫£n l√Ω th√¥ng tin v√† l·ªãch s·ª≠ mua h√†ng c·ªßa kh√°ch h√†ng</p>
    </div>
    <div class="header-right">
      <button class="add-btn" (click)="openAddModal()">
        <span class="btn-icon">+</span>
        Th√™m kh√°ch h√†ng
      </button>
    </div>
  </div>

  <!-- Stats -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">üë•</div>
      <div class="stat-content">
        <div class="stat-value">{{ totalCustomers() }}</div>
        <div class="stat-label">T·ªïng kh√°ch h√†ng</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-content">
        <div class="stat-value">{{ activeCustomers() }}</div>
        <div class="stat-label">Kh√°ch h√†ng ho·∫°t ƒë·ªông</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üí∞</div>
      <div class="stat-content">
        <div class="stat-value">{{ formatVnd(totalRevenue()) }}</div>
        <div class="stat-label">T·ªïng doanh thu</div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters">
    <div class="search-box">
      <input
        type="text"
        placeholder="T√¨m ki·∫øm kh√°ch h√†ng..."
        [value]="searchTerm()"
        (input)="onSearchInput($event)"
        class="search-input"
      />
      <span class="search-icon">üîç</span>
    </div>
    <select [value]="statusFilter()" (change)="onStatusChange($event)" class="status-filter">
      <option value="all">T·∫•t c·∫£ tr·∫°ng th√°i</option>
      <option value="active">Ho·∫°t ƒë·ªông</option>
      <option value="inactive">Kh√¥ng ho·∫°t ƒë·ªông</option>
    </select>
  </div>

  <!-- Customers Table -->
  <div class="customers-table-container">
    <table class="customers-table">
      <thead>
        <tr>
          <th>T√™n kh√°ch h√†ng</th>
          <th>Li√™n h·ªá</th>
          <th>ƒê·ªãa ch·ªâ</th>
          <th>ƒê∆°n h√†ng</th>
          <th>T·ªïng chi ti√™u</th>
          <th>L·∫ßn cu·ªëi</th>
          <th>Tr·∫°ng th√°i</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        @for (customer of filteredCustomers(); track customer.id) {
        <tr>
          <td>
            <div class="customer-info">
              <div class="customer-name">{{ customer.name }}</div>
              @if (customer.notes) {
              <div class="customer-notes">{{ customer.notes }}</div>
              }
            </div>
          </td>
          <td>
            <div class="contact-info">
              <div class="phone">{{ customer.phone }}</div>
              @if (customer.email) {
              <div class="email">{{ customer.email }}</div>
              }
            </div>
          </td>
          <td>
            <div class="address">{{ customer.address }}</div>
          </td>
          <td>
            <div class="orders-info">
              <div class="orders-count">{{ customer.totalOrders }} ƒë∆°n</div>
            </div>
          </td>
          <td>
            <div class="spent-amount">{{ formatVnd(customer.totalSpent) }}</div>
          </td>
          <td>
            <div class="last-order">{{ formatDateOrCurrent(customer.lastOrderDate) }}</div>
          </td>
          <td>
            <button
              class="status-btn"
              [class.active]="customer.status === 'active'"
              [class.inactive]="customer.status === 'inactive'"
              (click)="toggleCustomerStatus(customer)"
            >
              {{ customer.status === 'active' ? 'Ho·∫°t ƒë·ªông' : 'Kh√¥ng ho·∫°t ƒë·ªông' }}
            </button>
          </td>
          <td>
            <div class="action-buttons">
              <button class="edit-btn" (click)="openEditModal(customer)" title="Ch·ªânh s·ª≠a">
                ‚úèÔ∏è
              </button>
              <button class="delete-btn" (click)="deleteCustomer(customer.id)" title="X√≥a">
                üóëÔ∏è
              </button>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>

    @if (filteredCustomers().length === 0) {
    <div class="empty-state">
      <div class="empty-icon">üë•</div>
      <h3>Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng</h3>
      <p>Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c th√™m kh√°ch h√†ng m·ªõi</p>
    </div>
    }
  </div>
</div>

<!-- Add Customer Modal -->
@if (showAddModal()) {
<div class="modal-overlay" (click)="closeModals()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Th√™m kh√°ch h√†ng m·ªõi</h2>
      <button class="close-btn" (click)="closeModals()">√ó</button>
    </div>

    <div class="modal-body">
      <div class="form-group">
        <label>T√™n kh√°ch h√†ng *</label>
        <input
          type="text"
          [value]="newCustomer().name"
          (input)="onNewCustomerFieldChange('name', $event)"
          placeholder="Nh·∫≠p t√™n kh√°ch h√†ng..."
          class="form-input"
        />
      </div>

      <div class="form-group">
        <label>S·ªë ƒëi·ªán tho·∫°i *</label>
        <input
          type="tel"
          [value]="newCustomer().phone"
          (input)="onNewCustomerFieldChange('phone', $event)"
          placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i..."
          class="form-input"
        />
      </div>

      <div class="form-group">
        <label>Email</label>
        <input
          type="email"
          [value]="newCustomer().email"
          (input)="onNewCustomerFieldChange('email', $event)"
          placeholder="Nh·∫≠p email..."
          class="form-input"
        />
      </div>

      <div class="form-group">
        <label>ƒê·ªãa ch·ªâ</label>
        <textarea
          [value]="newCustomer().address"
          (input)="onNewCustomerFieldChange('address', $event)"
          placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ..."
          class="form-textarea"
          rows="3"
        ></textarea>
      </div>

      <div class="form-group">
        <label>Tr·∫°ng th√°i</label>
        <select
          [value]="newCustomer().status"
          (change)="onNewCustomerStatusChange($event)"
          class="form-select"
        >
          <option value="active">Ho·∫°t ƒë·ªông</option>
          <option value="inactive">Kh√¥ng ho·∫°t ƒë·ªông</option>
        </select>
      </div>

      <div class="form-group">
        <label>Ghi ch√∫</label>
        <textarea
          [value]="newCustomer().notes"
          (input)="onNewCustomerFieldChange('notes', $event)"
          placeholder="Nh·∫≠p ghi ch√∫..."
          class="form-textarea"
          rows="2"
        ></textarea>
      </div>
    </div>

    <div class="modal-footer">
      <button class="cancel-btn" (click)="closeModals()">H·ªßy</button>
      <button class="confirm-btn" (click)="addCustomer()">Th√™m kh√°ch h√†ng</button>
    </div>
  </div>
</div>
}

<!-- Edit Customer Modal -->
@if (showEditModal()) {
<div class="modal-overlay" (click)="closeModals()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Ch·ªânh s·ª≠a kh√°ch h√†ng</h2>
      <button class="close-btn" (click)="closeModals()">√ó</button>
    </div>

    <div class="modal-body">
      @if (selectedCustomer(); as customer) {
      <div class="form-group">
        <label>T√™n kh√°ch h√†ng *</label>
        <input
          type="text"
          [value]="customer.name"
          (input)="onCustomerFieldChange('name', $event)"
          placeholder="Nh·∫≠p t√™n kh√°ch h√†ng..."
          class="form-input"
        />
      </div>

      <div class="form-group">
        <label>S·ªë ƒëi·ªán tho·∫°i *</label>
        <input
          type="tel"
          [value]="customer.phone"
          (input)="onCustomerFieldChange('phone', $event)"
          placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i..."
          class="form-input"
        />
      </div>

      <div class="form-group">
        <label>Email</label>
        <input
          type="email"
          [value]="customer.email"
          (input)="onCustomerFieldChange('email', $event)"
          placeholder="Nh·∫≠p email..."
          class="form-input"
        />
      </div>

      <div class="form-group">
        <label>ƒê·ªãa ch·ªâ</label>
        <textarea
          [value]="customer.address"
          (input)="onCustomerFieldChange('address', $event)"
          placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ..."
          class="form-textarea"
          rows="3"
        ></textarea>
      </div>

      <div class="form-group">
        <label>Tr·∫°ng th√°i</label>
        <select
          [value]="customer.status"
          (change)="onCustomerFieldChange('status', $event)"
          class="form-select"
        >
          <option value="active">Ho·∫°t ƒë·ªông</option>
          <option value="inactive">Kh√¥ng ho·∫°t ƒë·ªông</option>
        </select>
      </div>

      <div class="form-group">
        <label>Ghi ch√∫</label>
        <textarea
          [value]="customer.notes"
          (input)="onCustomerFieldChange('notes', $event)"
          placeholder="Nh·∫≠p ghi ch√∫..."
          class="form-textarea"
          rows="2"
        ></textarea>
      </div>
      }
    </div>

    <div class="modal-footer">
      <button class="cancel-btn" (click)="closeModals()">H·ªßy</button>
      <button class="confirm-btn" (click)="updateCustomer()">C·∫≠p nh·∫≠t</button>
    </div>
  </div>
</div>
}
