<div class="products-container">
  <!-- Header -->
  <div class="products-header">
    <div class="header-left">
      <h1>Qu·∫£n l√Ω s·∫£n ph·∫©m</h1>
      <p>Qu·∫£n l√Ω danh m·ª•c s·∫£n ph·∫©m v√† t·ªìn kho</p>
    </div>
    <div class="header-right">
      <button class="add-product-btn" (click)="openAddModal()">
        <span>+</span>
        Th√™m s·∫£n ph·∫©m
      </button>
    </div>
  </div>

  <!-- Statistics -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">üì¶</div>
      <div class="stat-content">
        <div class="stat-value">{{ totalProducts() }}</div>
        <div class="stat-label">T·ªïng s·∫£n ph·∫©m</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-content">
        <div class="stat-value">{{ activeProducts() }}</div>
        <div class="stat-label">ƒêang b√°n</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">‚ö†Ô∏è</div>
      <div class="stat-content">
        <div class="stat-value">{{ lowStockProducts().length }}</div>
        <div class="stat-label">S·∫Øp h·∫øt h√†ng</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üí∞</div>
      <div class="stat-content">
        <div class="stat-value">{{ formatVnd(totalValue()) }}</div>
        <div class="stat-label">Gi√° tr·ªã t·ªìn kho</div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="search-box">
      <input
        type="text"
        placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..."
        [value]="searchTerm()"
        (input)="onSearchInput($event)"
      />
      <span class="search-icon">üîç</span>
    </div>
    <select [value]="selectedCategory()" (change)="onCategoryChange($event)" class="filter-select">
      @for (category of categories(); track category.id) {
      <option [value]="category.id">{{ category.name }}</option>
      }
    </select>
    <select [value]="selectedStatus()" (change)="onStatusChange($event)" class="filter-select">
      <option value="all">T·∫•t c·∫£ tr·∫°ng th√°i</option>
      <option value="active">ƒêang b√°n</option>
      <option value="inactive">Ng·ª´ng b√°n</option>
    </select>
  </div>

  <!-- Products Table -->
  <div class="products-table-container">
    <table class="products-table">
      <thead>
        <tr>
          <th>H√¨nh ·∫£nh</th>
          <th>T√™n s·∫£n ph·∫©m</th>
          <th>SKU</th>
          <th>Danh m·ª•c</th>
          <th>Gi√° b√°n</th>
          <th>T·ªìn kho</th>
          <th>Tr·∫°ng th√°i</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        @for (product of filteredProducts(); track product.id) {
        <tr>
          <td>
            <div class="product-image">
              <img [src]="product.imageUrl" [alt]="product.name" />
            </div>
          </td>
          <td>
            <div class="product-info">
              <div class="product-name">{{ product.name }}</div>
              <div class="product-description">{{ product.description }}</div>
            </div>
          </td>
          <td>
            <span class="sku">{{ product.sku }}</span>
          </td>
          <td>
            <span class="category">{{ product.category }}</span>
          </td>
          <td>
            <div class="price-info">
              <div class="price">{{ formatVnd(product.price) }}</div>
              <div class="cost">Gi√° v·ªën: {{ formatVnd(product.cost) }}</div>
            </div>
          </td>
          <td>
            <div class="stock-info">
              <div class="stock-quantity" [class]="'stock-' + getStockStatus(product)">
                {{ product.stock }}
              </div>
              <div class="stock-range">
                Min: {{ product.minStock }} | Max: {{ product.maxStock }}
              </div>
            </div>
          </td>
          <td>
            <button
              class="status-btn"
              [class]="'status-' + product.status"
              (click)="toggleProductStatus(product)"
            >
              {{ product.status === 'active' ? 'ƒêang b√°n' : 'Ng·ª´ng b√°n' }}
            </button>
          </td>
          <td>
            <div class="action-buttons">
              <button class="edit-btn" (click)="openEditModal(product)">‚úèÔ∏è</button>
              <button class="delete-btn" (click)="deleteProduct(product.id)">üóëÔ∏è</button>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Add Product Modal -->
  @if (showAddModal()) {
  <div class="modal-overlay" (click)="closeModals()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Th√™m s·∫£n ph·∫©m m·ªõi</h3>
        <button class="close-btn" (click)="closeModals()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>T√™n s·∫£n ph·∫©m *</label>
          <input type="text" [(ngModel)]="newProduct().name" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m" />
        </div>
        <div class="form-group">
          <label>M√¥ t·∫£</label>
          <textarea
            [(ngModel)]="newProduct().description"
            placeholder="Nh·∫≠p m√¥ t·∫£ s·∫£n ph·∫©m"
            rows="3"
          ></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>SKU *</label>
            <input type="text" [(ngModel)]="newProduct().sku" placeholder="M√£ s·∫£n ph·∫©m" />
          </div>
          <div class="form-group">
            <label>Danh m·ª•c *</label>
            <input
              type="text"
              [(ngModel)]="newProduct().category"
              placeholder="Danh m·ª•c s·∫£n ph·∫©m"
            />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Gi√° b√°n (VNƒê)</label>
            <input type="number" [(ngModel)]="newProduct().price" placeholder="0" />
          </div>
          <div class="form-group">
            <label>Gi√° v·ªën (VNƒê)</label>
            <input type="number" [(ngModel)]="newProduct().cost" placeholder="0" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>T·ªìn kho hi·ªán t·∫°i</label>
            <input type="number" [(ngModel)]="newProduct().stock" placeholder="0" />
          </div>
          <div class="form-group">
            <label>URL h√¨nh ·∫£nh</label>
            <input
              type="text"
              [(ngModel)]="newProduct().imageUrl"
              placeholder="B·∫•m ƒë·ªÉ ch·ªçn ·∫£nh t·ª´ m√°y ho·∫∑c d√°n URL"
              readonly
              (click)="addImageFileInput.click()"
            />
            <input
              type="file"
              #addImageFileInput
              accept="image/*"
              style="display: none"
              (change)="onLocalImageSelected($event, 'add')"
            />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>T·ªìn kho t·ªëi thi·ªÉu</label>
            <input type="number" [(ngModel)]="newProduct().minStock" placeholder="0" />
          </div>
          <div class="form-group">
            <label>T·ªìn kho t·ªëi ƒëa</label>
            <input type="number" [(ngModel)]="newProduct().maxStock" placeholder="0" />
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn" (click)="closeModals()">H·ªßy</button>
        <button class="save-btn" (click)="addProduct()">Th√™m s·∫£n ph·∫©m</button>
      </div>
    </div>
  </div>
  }

  <!-- Edit Product Modal -->
  @if (showEditModal() && selectedProduct()) {
  <div class="modal-overlay" (click)="closeModals()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Ch·ªânh s·ª≠a s·∫£n ph·∫©m</h3>
        <button class="close-btn" (click)="closeModals()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>T√™n s·∫£n ph·∫©m *</label>
          <input
            type="text"
            [value]="selectedProduct()?.name"
            (input)="onProductFieldChange('name', $event)"
          />
        </div>
        <div class="form-group">
          <label>M√¥ t·∫£</label>
          <textarea
            [value]="selectedProduct()?.description"
            (input)="onProductFieldChange('description', $event)"
            rows="3"
          ></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>SKU *</label>
            <input
              type="text"
              [value]="selectedProduct()?.sku"
              (input)="onProductFieldChange('sku', $event)"
            />
          </div>
          <div class="form-group">
            <label>Danh m·ª•c *</label>
            <input
              type="text"
              [value]="selectedProduct()?.category"
              (input)="onProductFieldChange('category', $event)"
            />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Gi√° b√°n (VNƒê)</label>
            <input
              type="number"
              [value]="selectedProduct()?.price"
              (input)="onProductNumberFieldChange('price', $event)"
            />
          </div>
          <div class="form-group">
            <label>Gi√° v·ªën (VNƒê)</label>
            <input
              type="number"
              [value]="selectedProduct()?.cost"
              (input)="onProductNumberFieldChange('cost', $event)"
            />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>T·ªìn kho hi·ªán t·∫°i</label>
            <input
              type="number"
              [value]="selectedProduct()?.stock"
              (input)="onProductNumberFieldChange('stock', $event)"
            />
          </div>
          <div class="form-group">
            <label>URL h√¨nh ·∫£nh</label>
            <input
              type="text"
              [value]="selectedProduct()?.imageUrl"
              readonly
              (click)="editImageFileInput.click()"
            />
            <input
              type="file"
              #editImageFileInput
              accept="image/*"
              style="display: none"
              (change)="onLocalImageSelected($event, 'edit')"
            />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>T·ªìn kho t·ªëi thi·ªÉu</label>
            <input
              type="number"
              [value]="selectedProduct()?.minStock"
              (input)="onProductNumberFieldChange('minStock', $event)"
            />
          </div>
          <div class="form-group">
            <label>T·ªìn kho t·ªëi ƒëa</label>
            <input
              type="number"
              [value]="selectedProduct()?.maxStock"
              (input)="onProductNumberFieldChange('maxStock', $event)"
            />
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn" (click)="closeModals()">H·ªßy</button>
        <button class="save-btn" (click)="updateProduct()">C·∫≠p nh·∫≠t</button>
      </div>
    </div>
  </div>
  }
</div>
